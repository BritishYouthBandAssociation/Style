'use strict';

const sass = require('sass');
const fs = require('fs');
const path = require('path');

class Builder {
	vars = {};

	setVariable(name, value) {
		this.vars[name] = value;
		return this; //allow chaining
	}

	getVariables() {
		const varString = Object.entries(this.vars).map(([k, v]) => `$${k}: ${v};`).join("\n");
		console.log(`Vars: ${varString}`);
		return varString;
	}

	//readonly-ish
	#getHeader(){
		const today = new Date();
		return `/*! 		
	BYBA Bandmaster Framework Stylesheet (generated ${today.toLocaleString()})
	This file is generated by a tool - please make any changes in the respective SCSS
	files and recompile, otherwise you risk your changes being overwritten!
*/
`;
	}

	build(src, dest) {
		//src = path.resolve(src);
		const dir = path.dirname(src);

		const sassStr = `${this.#getHeader()} ${this.getVariables()} @import '${src}';`;

		const res = sass.compileString(sassStr, {
			loadPaths: [dir]
		});

		fs.writeFileSync(dest, res.css.toString());
		console.log(`CSS written to ${dest}`);
	}
}

module.exports = Builder;
